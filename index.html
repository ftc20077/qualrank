<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FTC Qual Point Calculator</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f0f8ff;
      color: #003366;
    }
    h1 {
      color: #002244;
      font-weight: 600;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #00509e;
      font-family: 'Poppins', sans-serif;
    }
    button {
      background-color: #00509e;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background-color: #003366;
    }
    .result-box {
      width: 60%;
      margin: 30px auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.08);
      padding: 24px;
      font-size: 1.3em;
      color: #00509e;
    }
  </style>
</head>
<body>
  <h1>FTC Qual Point Calculator</h1>
  <label for="numTeams">Number of Teams (N):</label>
  <input id="numTeams" type="number" min="2" step="1" placeholder="e.g. 36">
  <label for="qualRank">Your Qual Rank (R):</label>
  <input id="qualRank" type="number" min="1" step="1" placeholder="e.g. 11">
  <br>
  <button onclick="calculateQualPoints()">Calculate Qual Points</button>
  <div id="result" class="result-box"></div>

  <script>
    // Java's Math.copySign in JS
    function copySign(x, y) {
      return Math.abs(x) * (y < 0 ? -1 : 1);
    }

    // Winitzki approximation for inverse error function
    function approxInverseErrorFunction(x) {
      // clamp x to (-0.999999, 0.999999) to avoid log(0)
      x = Math.max(-0.999999, Math.min(0.999999, x));
      let a = 0.147;
      let ln = Math.log(1 - x * x);
      let part1 = (2 / (Math.PI * a)) + (ln / 2.0);
      let part2 = ln / a;
      let sqrtInner = Math.sqrt(part1 * part1 - part2);
      return copySign(Math.sqrt(sqrtInner - part1), x);
    }

    function calculateQualPoints() {
      const N = parseFloat(document.getElementById('numTeams').value);
      const R = parseFloat(document.getElementById('qualRank').value);
      const resultDiv = document.getElementById('result');

      // Input validation
      if (isNaN(N) || isNaN(R) || N < 2 || R < 1 || R > N) {
        resultDiv.textContent = "Please enter valid numbers: N ≥ 2, 1 ≤ R ≤ N.";
        return;
      }

      const alpha = 1.07;
      const inner = (N - 2 * R + 2) / (alpha * N);
      const invErfInner = approxInverseErrorFunction(inner);
      const invErfAlpha = approxInverseErrorFunction(1.0 / alpha);

      let result = Math.ceil(invErfInner * (7.0 / invErfAlpha) + 9);

      resultDiv.textContent = `Qualification Points: ${result}`;
    }
  </script>
</body>
</html>
